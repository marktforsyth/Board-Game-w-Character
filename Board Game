from random import randint
from Board import board

player_status = {
  "coins": 0,
  "health": 100,
  "damage": 1,
}

def make_divider(size):
  divider = []
  for i in range(size):
    divider.append('---')
  return '|'.join(divider)

divider = make_divider(len(board))

def printBoard():
  for d in range(1, (len(board) + 1)):
    print()
    print(divider)
    for i in range(1, len(board) + 1):
      if i == len(board):
        print(" " + str(board[i][d]), end="")
      else:
        print(" " + str(board[i][d]) + " |", end="")
  print("\n"*2)
  print("Coins: " + str(player_status["coins"]))
  print("Health: " + str(player_status["health"]) + "\n\n")

global chestX, chestY
chestX = randint(1, len(board))
chestY = randint(1, len(board))
board[chestX][chestY] = "T"

global enemyX, enemyY
enemyX = randint(1, len(board))
enemyY = randint(1, len(board))
enemyX = 1
enemyY = 1
board[enemyX][enemyY] = "E"

global x, y
x = randint(1, len(board))
y = randint(1, len(board))
board[x][y] = "C"

global enemyHealth
enemyHealth = 5

global has_health_potion
has_health_potion = False

def attack():
  global enemyHealth
  
  if enemyX + 1 == x or enemyX - 1 == x or enemyY + 1 == y or enemyY - 1 == y:
    enemyHealth -= player_status["damage"]
    print("The enemy is at " + str(enemyHealth) + " health.")
  else:
    print("There are no enemies to attack!")

def healthBoost():
  global has_health_potion
  
  if has_health_potion == True:
    player_status["health"] += 15
    print("Your health has been raised by 15!")
    has_health_potion = False
  else:
    print("\nYou don't have a health potion!")

def enemyMove():
  global enemyX, enemyY
  cmd = randint(1, 4)

  xVal = abs(enemyX - x)
  yVal = abs(enemyY - y)
  
  dx = 0
  dy = 0
  
  if xVal > yVal:
    if x > enemyX:
      dx = 1
    else:
      dx = -1
  else:
    if y > enemyY:
      dy = 1
    else:
      dy = -1
  
  if enemyX + dx == x and enemyY + dy == y:
    print("Oh no! Then enemy hit you!")
    player_status["health"] -= 10
  else:
    board[enemyX][enemyY] = " "
    enemyX += dx
    enemyY += dy
    board[enemyX][enemyY] = "E"

def check():
  global x, y, enemyX, enemyY
  cmd = input(">>> ")
  
  dx = 0
  dy = 0
  should_regen_health = True
    
  if cmd == "up":
    if y <= 1:
      print("\nYou cannot go up past here!")
    else:
      dy = -1
  elif cmd == "down":
    if y >= len(board):
      print("\nYou cannot go down past here!")
    else:
      dy = 1
  elif cmd == "right":
    if x >= len(board):
      print("\nYou cannot go right past here!")
    else:
      dx = 1
  elif cmd == "left":
    if x <= 1:
      print("\nYou cannot go left past here!")
    else:
      dx = -1
  elif cmd == "attack":
    attack()
    should_regen_health = False
  elif cmd == "health boost":
    healthBoost()
    should_regen_health = False
  else:
    print("\nWe do not recognize your command")
    should_regen_health = False
  
  if should_regen_health:
    rand_healing = randint(1, 5)
    player_status["health"] += rand_healing
  
  if x + dx == enemyX and y + dy == enemyY:
    print("Oh no! The enemy hit you!")
    if x + dx*2 <= 0 or y + dy*2 <= 0 or x + dx*2 >= len(board) or y + dy*2 >= len(board):
      board[x][y] = " "
      enemyX = x
      enemyY = y
      x += dx
      y += dy
      board[x][y] = "C"
      
      board[enemyX][enemyY] = "E"
    else:
      board[x][y] = " "
      x += dx*2
      y += dy*2
      board[x][y] = "C"
  else:
    board[x][y] = " "
    x += dx
    y += dy
    board[x][y] = "C"

print("Your commands are 'up', 'down', 'left', 'right', 'attack' and 'health boost'\n")

while True:
  enemyMove()
  printBoard()
  check()
  
  if player_status["health"] >= 100:
    player_status["health"] = 100
  
  if x == chestX and y == chestY:
    printBoard()
    
    treasure_pick = randint(1, 3)
    print("You've found the treasure! Congratulations!")
    if treasure_pick == 1:
      print("You recieved 50 gold!")
      player_status["coins"] += 50
    elif treasure_pick == 2:
      print("You got a better sword!")
      player_status["damage"] += 2
    elif treasure_pick == 3:
      print("You got a health potion!")
      has_health_potion = True
    
    chestX = randint(1, len(board))
    chestY = randint(1, len(board))
    board[chestX][chestY] = "T"
  elif enemyX == chestX and enemyY == chestY:
    print("Oh no! The enemy got to the chest before you! Good luck on the next one!")
    chestX = randint(1, len(board))
    chestY = randint(1, len(board))
    board[chestX][chestY] = "T"
    
  if player_status["health"] <= 0:
    print("You died. :(")
    break

  if enemyHealth <= 0:
    enemyGold = randint(1, 10)
    print("You killed the enemy! You loot it and find " + str(enemyGold) + " gold.")
    player_status["coins"] += enemyGold
    
    board[enemyX][enemyY] = " "
    enemyX = randint(1, len(board))
    enemyY = randint(1, len(board))
    board[enemyX][enemyY] = "E"
    
    enemyHealth = 5
